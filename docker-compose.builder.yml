version: "3"

x-backend-auth-base: &backendauth
  image: node:16
  volumes:
    - node_modules_backend_auth:/usr/src/service/node_modules
    - ./packages/backend-auth:/usr/src/service/
  working_dir: /usr/src/service/

x-backend-courses-base: &backendcourses
  image: node:16
  volumes:
    - node_modules_backend_courses:/usr/src/service/node_modules
    - ./packages/backend-courses:/usr/src/service/
  working_dir: /usr/src/service/

x-gateway-base: &gateway
  image: node:16
  volumes:
    - node_modules_gateway:/usr/src/service/node_modules
    - ./packages/relay-gateway:/usr/src/service/
  working_dir: /usr/src/service/

x-frontend-base: &frontend
  image: node:16
  volumes:
    - node_modules_frontend:/usr/src/service/node_modules
    - ./packages/frontend-courses:/usr/src/service/
  working_dir: /usr/src/service/

x-lerna-base: &lerna
  image: node:16
  volumes:
    - node_modules_lerna:/usr/src/service/node_modules
    - ./:/usr/src/service/
  working_dir: /usr/src/service/

services:
  install_backend_auth:
    <<: *backendauth
    command: npm i

  install_backend_courses:
    <<: *backendcourses
    command: npm i

  install_frontend:
    <<: *frontend
    command: npm i

  install_gateway:
    <<: *gateway
    command: npm i

  install_lerna:
    <<: *lerna
    command: npm i

volumes:
  node_modules_backend_auth:
    external: true
  node_modules_backend_courses:
    external: true
  node_modules_frontend:
    external: true
  node_modules_gateway:
    external: true
  node_modules_lerna:
    external: true
